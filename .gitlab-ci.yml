stages:
  - build
  - test-postman
  - test-cypress

# Instalar las dependencias de Node.js
install_dependencies:
  stage: build  # Usamos la etapa 'build' en lugar de 'install'
  image: node:16  # Usamos una imagen de Node.js que incluye npm
  script:
    - npm install  # Instalar todas las dependencias definidas en package.json
    - npm install -g newman  # Instalar Newman globalmente para las pruebas de Postman

# Ejecutar las pruebas de Postman con Newman
test-postman:
  stage: test-postman
  image: node:16  # Usamos una imagen con Node.js preinstalado
  script:
    - newman run ./API-PickleRick.postman_collection.json --reporters cli,junit --reporter-junit-export ./newman/results.xml
  artifacts:
    paths:
      - newman/results.xml  # Guardar el reporte de resultados de Newman
  only:
    - master

# Ejecutar las pruebas de Cypress
cypress_test:
  stage: test-cypress
  image: cypress/included:12.0.0  # Usamos la imagen oficial de Cypress
  script:
    - npm test  # Ejecuta el script "test" que correr√° las pruebas de Cypress
  artifacts:
    paths:
      - cypress/videos  # Guardar los videos de las pruebas
      - cypress/screenshots  # Guardar las capturas de pantalla
  only:
    - master

#test-postman:
  #stage: test
  #image: node:16 # Usamos una imagen con Node.js preinstalado
  #script:
    #- newman run API-PickleRick.postman_collection.json --reporters cli,junit --reporter-junit-export ./newman/results.xml
  #artifacts:
    #paths:
      #- newman/results.xml # Guardar el reporte de resultados
  #only:
    #- master